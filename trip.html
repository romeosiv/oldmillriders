<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Trips - Old Mill Riders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="./moulin-coeur-noir.png" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.5.0/gpx.min.js"></script>
  <style>
    /* ---------- Reset & Base ---------- */
    body { font-family:'Space Grotesk',sans-serif; background:#e5e5e5; margin:0; color:#000; }
    .container { max-width:1024px; margin:0 auto; padding:0 1rem; }

    /* ---------- HEADER ---------- */
    header { background:#000; color:#fff; border-radius:20px; padding:1rem 2rem;
      display:flex; align-items:center; justify-content:space-between;
      position:relative; margin:20px auto; max-width:1024px; box-sizing:border-box;
    }
    .left-nav,.right-nav { display:flex; align-items:center; gap:1.5rem; }
    .center-title { position:absolute; left:50%; transform:translateX(-50%);
      font-size:1.8rem; font-weight:bold; white-space:nowrap;
    }
    .center-title a,.center-title a:visited { color:inherit; text-decoration:none; }
    nav { display:flex; align-items:center; gap:1rem; }
    nav a { position:relative; color:#fff; text-decoration:none; font-size:1rem; }
    nav a::after { content:""; position:absolute; left:0; bottom:-2px;
      width:0; height:1px; background:#fff; transition:width .3s ease;
    }
    nav a:hover::after, nav a.active::after { width:100%; }
    .menu-toggle { display:none; background:none; border:none;
      font-size:1.5rem; color:#fff; cursor:pointer;
    }
    .icon { width:28px; height:28px; }
    .insta-icon { width:16px; display:block; }

    /* ---------- HERO ---------- */
    .hero {
      background-image:image-set(
        url('./trips-desktop.jpg') 1x,
        url('./trips-desktop@2x.jpg') 2x
      );
      background-size:cover; background-position:center;
      filter:grayscale(100%); border-radius:20px;
      margin:0 auto 20px; max-width:1024px; aspect-ratio:1024/350;
      position:relative;
    }
    @media (max-width:768px) {
      .hero {
        background-image:image-set(
          url('./trips-mobile.jpg') 1x,
          url('./trips-mobile@2x.jpg') 2x
        );
      }
    }
    .hero-text {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%); color:#fff;
      font-size:2.5rem; text-align:center;
      text-shadow:0 0 8px rgba(0,0,0,0.7);
    }

    /* ---------- ABOUT BLOCK ---------- */
    .about-block {
      background:#000; color:#fff; padding:2rem;
      border-radius:20px; margin:20px auto;
      text-align:center; font-size:1rem; line-height:1.5;
      box-sizing:border-box;
    }

    /* ---------- TRIPS WRAPPER ---------- */
    .rv-cards-wrapper {
      display:flex; gap:1.5rem; flex-wrap:wrap;
      justify-content:space-between; margin:2rem 0;
    }

    /* ---------- TRIP CARD ---------- */
    .rv-card {
      background:#fff; border-radius:12px; overflow:hidden;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      width:calc(33.333% - 1rem); cursor:pointer;
      transition:transform .15s ease;
    }
    .rv-card:hover { transform:scale(1.02); }
    .rv-card-header {
      display:flex; justify-content:space-between;
      padding:.5rem 1rem; background:#f5f5f5; align-items:center;
    }
    .rv-card-id { font-weight:bold; font-size:1.25rem; }
    .badge-icon { width:24px; height:24px; object-fit:contain; margin-left:.5rem; }
    .rv-card-media img { width:100%; display:block; }
    .rv-card-body { padding:1rem; }
    .rv-card-title-row {
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:.5rem;
    }
    .rv-card-title { font-size:1.1rem; margin:0; }
    .rv-card-rating { font-size:.9rem; }
    .rv-card-text {
      margin:0 0 1rem; font-size:.9rem; color:#444;
    }
    .rv-cards-wrapper .rv-card-text {
      display:-webkit-box; -webkit-box-orient:vertical;
      -webkit-line-clamp:2; overflow:hidden;
    }

    /* ---------- MÉTA & STATS ---------- */
    .rv-card-meta { display:flex; gap:1rem; margin-bottom:1rem; }
    .rv-card-stats {
      display:grid; grid-template-columns:repeat(2,auto);
      gap:.75rem 1.5rem;
    }
    .rv-card-stats .stat small {
      display:block; font-size:.75rem; color:#666;
      text-transform:uppercase; letter-spacing:.5px;
      margin-bottom:.25rem;
    }
    .rv-card-stats .stat strong {
      display:block; font-size:.95rem; color:#000;
    }
    .rv-card-footer {
      display:flex; align-items:center; justify-content:space-between;
      padding:0 1rem 1rem;
    }
    .rv-card-link {
      font-size:.85rem; text-decoration:none; color:#0077cc;
    }
    .rv-card-link:hover { text-decoration:underline; }

    /* ---------- MODAL TRIP ---------- */
    .modal {
      display:none; position:fixed; top:0; left:0;
      width:100%; height:100%; background:rgba(0,0,0,0.5);
      justify-content:center; align-items:center;
      padding:1rem; box-sizing:border-box; z-index:1000;
    }
    .modal-content {
      background:#fff; border-radius:12px;
      max-width:600px; width:100%; padding:1.5rem;
      position:relative; max-height:90vh; overflow-y:auto;
    }
    #trip-modal .rv-card-text {
      display:block; overflow:visible;
      -webkit-line-clamp:unset; -webkit-box-orient:initial;
    }
    #trip-modal .rv-card-media { display:none; }
    #map-modal { height:300px; border-radius:12px; margin-bottom:1rem; }
    #trip-modal-card .rv-card {
      width:100%; margin:0; box-shadow:none;
      transform:none!important; cursor:default;
    }

    /* ---------- GALERIE ---------- */
    .trip-gallery-modal { margin-top:1.5rem; }
    .trip-gallery-modal h4 {
      margin:0 0 .5rem; font-size:1rem; font-weight:bold;
    }
    .gallery-thumbs {
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .gallery-thumbs img {
      width:70px; height:70px; object-fit:cover;
      border-radius:6px; cursor:pointer; border:none; box-shadow:none;
    }
    .gallery-thumbs .thumb-video {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 6px;
      cursor: pointer;
      background-color: #000;
    }

    /* ---------- LIGHTBOX ---------- */
    #image-modal .modal-content {
      background:transparent; padding:0; box-shadow:none;
      display:flex; justify-content:center; align-items:center;
    }
    .image-lightbox {
      position:relative; display:flex; align-items:center; justify-content:center;
    }
    .image-modal-img {
      max-width:90vw; max-height:90vh; width:auto; height:auto;
    }
    .lightbox-prev,.lightbox-next {
      position:absolute; top:50%; transform:translateY(-50%);
      background:rgba(255,255,255,0.8); border:none;
      font-size:2rem; padding:.2rem .6rem; cursor:pointer;
      border-radius:4px; user-select:none;
    }
    .lightbox-prev { left:1rem; } .lightbox-next { right:1rem; }
    .lightbox-prev:hover,.lightbox-next:hover { background:#fff; }
    
    /* Empêche le conteneur lightbox de déborder de l'écran */
#image-modal .modal-content {
  max-width: 90vw;
  max-height: 90vh;
  overflow: hidden;
  padding: 0;
}

/* Redimensionne l'image/vidéo dans la lightbox pour qu'elle rentre toujours */
#image-modal .image-modal-img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

    /* ---------- FOOTER ---------- */
    .footer {
      background:#e5e5e5; color:#000; padding:20px 0;
      display:flex; align-items:center; justify-content:flex-start;
      border-radius:20px; max-width:1024px; margin:3rem auto 0;
      box-sizing:border-box; flex-wrap:wrap;
    }
    .footer .left-footer {
      display:flex; align-items:center; gap:1rem; margin-left:1rem;
    }
    .footer .left-footer img { width:28px; height:28px; }
    .footer .left-footer a,.footer .left-footer a:visited {
      color:#000; text-decoration:none;
    }
    .footer .right-footer {
      display:flex; gap:1.5rem; margin-left:auto; margin-right:1rem;
    }
    .footer .right-footer a {
      text-decoration:none; font-weight:normal;
      color:#000; font-size:1rem; cursor:pointer;
    }

    /* ---------- RESPONSIVE ---------- */
    @media(max-width:768px){
      header{padding:.5rem 1rem;}
      .center-title{position:static!important;transform:none!important;
        font-size:1.4rem!important;text-align:center!important;
        width:100%!important;margin:0 auto!important;
      }
      .left-nav a.logo{display:none;}
      .menu-toggle{display:block;}
      nav{display:none;flex-direction:column;gap:1rem;
        position:absolute;top:100%;left:0;right:0;
        padding:1rem;background:#000;border-radius:20px;z-index:10;
      }
      nav.open{display:flex;}
      .hero{margin-bottom:1rem;}
      .about-block{margin:1rem auto;}
      .rv-cards-wrapper{margin:1rem 0;gap:.75rem;}
      .rv-card{width:100%;margin:.5rem 0;}
      .gallery-thumbs img{width:60px;height:60px;}
      .gallery-thumbs .thumb-video {
      width: 60px;
      height: 60px;
        }
      .lightbox-prev,.lightbox-next{display:none;}
      .footer{flex-direction:column;align-items:center;padding:10px 1rem;}
      .footer .left-footer,.footer .right-footer{
        width:100%;display:flex;justify-content:center;margin:.25rem 0;
      }
      .footer .right-footer{flex-wrap:wrap;gap:.5rem;}
      .footer .right-footer a{font-size:.75rem;white-space:nowrap;}
      .footer .left-footer img{width:20px;height:20px;}
    }
    /* ===== Limiter la taille de la vidéo dans la lightbox ===== */
#image-modal .modal-content {
  /* on empêche le contenu de déborder */
  max-height: 80vh;
  overflow: hidden;
}
#image-modal .image-modal-img {
  /* s’assure que la vidéo/ l’image rentre dans 90% de la fenêtre */
  max-width: 90vw;
  max-height: 80vh;
  object-fit: contain;
}
  </style>
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <header>
      <div class="left-nav">
        <a href="home.html" class="logo"><img src="./moulin-coeur-blanc.png" class="icon" alt="Logo"></a>
        <button class="menu-toggle" aria-label="Menu">☰</button>
        <nav>
          <a href="labande.html">La Bande</a>
          <a href="LeShop.html">Le Shop</a>
          <a href="trip.html" class="active">Trips</a>
        </nav>
      </div>
      <div class="center-title"><a href="home.html">Old Mill Riders</a></div>
      <div class="right-nav">
        <a href="https://www.instagram.com/old_mill_riders/" target="_blank">
          <img src="https://img.icons8.com/ios-filled/50/ffffff/instagram-new.png" class="insta-icon" alt="Instagram">
        </a>
      </div>
    </header>

    <!-- HERO -->
    <div class="hero"><div class="hero-text">Viens on part</div></div>

    <!-- ABOUT BLOCK -->
    <div class="about-block">
      Prépare ta moto et on prend la route !<br>
      Pas besoin de grand chose : la tente, deux trois outils et ce qu'il faut d'affaire. <br>
      Des cols sinueux, des forêts verdoyantes, des rivières tumultueuses…<br>
      tout l’esprit Old Mill Riders dans des trips inoubliables !
    </div>

    <!-- CARTES -->
    <div class="rv-cards-wrapper">
      <!-- Carte 01 -->
      <article class="rv-card"
               id="trip-01"
               data-gpx="roadbook-chartreusealpes.gpx"
               data-images="IMG_9380.JPEG,IMG_9384.JPEG,IMG_9385.JPEG,IMG_9387.JPEG,IMG_9392.JPEG,IMG_9393.JPEG,IMG_9416.JPEG,IMG_9423.JPEG,IMG_9425.JPEG,IMG_7860.JPEG,IMG_9375.JPEG">
        <div class="rv-card-header">
          <span class="rv-card-id">01</span>
          <div class="rv-card-badges">
            <img src="forest.png" class="badge-icon" alt="Forêt">
            <img src="montage.png" class="badge-icon" alt="Montagne">
          </div>
        </div>
        <div class="rv-card-media">
          <img src="IMG_9380.JPEG" alt="Entre Chartreuse et massif des Grandes Rousses">
        </div>
        <div class="rv-card-body">
          <div class="rv-card-title-row">
            <h3 class="rv-card-title">Entre Chartreuse et massif des Grandes Rousses</h3>
            <span class="rv-card-rating">★★★☆</span>
          </div>
          <p class="rv-card-text">
            Une virée de 2 jours au cœur du massif de la Chartreuse puis des Grandes Rousses. Entre forêts humides et cols étroits. On traverse d'abord la Chartreuse pour arriver en fin de journée à Chamrousse.
            Le lendemain on pousse jusqu'à l'Alpe d'Huez et ses mythiques lacets pour ensuite revenir sur Grenoble et profiter d'un bon restaurant. Puis retour tranquille sur Lyon, des paysages pleins la tête.
          </p>
          <div class="rv-card-meta">
            <div class="rv-card-stats">
              <div class="stat"><small>Distance</small><strong>504 km</strong></div>
              <div class="stat"><small>Altitude max ↑</small><strong>1 854 m</strong></div>
              <div class="stat"><small>Durée</small><strong>2 jours</strong></div>
              <div class="stat"><small>Niveau</small><strong>Débutant</strong></div>
            </div>
          </div>
          <div class="rv-card-footer">
            <a href="roadbook-chartreusealpes.gpx" class="rv-card-link" target="_blank">Télécharger GPX</a>
          </div>
        </div>
      </article>

      <!-- Carte 02 -->
      <article class="rv-card"
               id="trip-02"
               data-gpx="j1-rdga-thonon-les-bains-beaufort.gpx"
               data-images="rdgaj1.JPEG,j1rdga1.JPEG,j1rdga2.JPEG,j1rdga3.JPEG,j1rdga4.JPEG">
        <div class="rv-card-header">
          <span class="rv-card-id">02</span>
          <div class="rv-card-badges">
            <img src="mer.png" class="badge-icon" alt="Mer">
            <img src="montage.png" class="badge-icon" alt="Montagne">
          </div>
        </div>
        <div class="rv-card-media">
          <img src="rdgaj1.JPEG" alt="RDGA Jour 1 – De Thonon à Beaufort">
        </div>
        <div class="rv-card-body">
          <div class="rv-card-title-row">
            <h3 class="rv-card-title">RDGA Jour 1 – De Thonon à Beaufort</h3>
            <span class="rv-card-rating">★★★★</span>
          </div>
          <p class="rv-card-text">
          Premier tronçon de la Route des Grandes Alpes. Entre Thonon et Beaufort. Après avoir roulé jusqu'à Thonon depuis Lyon, petit ravitaillement avant de repartir. On suit la Dranse jusqu'à Morzine avant d'attaquer quelques kilomètres puis loin le premier col, le col de la Colombière. Suivront ensuite La Croix de Fer, et le col des Saisies et Beaufort.          </p>          </p>
          <div class="rv-card-meta">
            <div class="rv-card-stats">
              <div class="stat"><small>Distance</small><strong>145 km</strong></div>
              <div class="stat"><small>Altitude max ↑</small><strong>1 659 m</strong></div>
              <div class="stat"><small>Durée</small><strong>3 h</strong></div>
              <div class="stat"><small>Niveau</small><strong>Intermédiaire</strong></div>
            </div>
          </div>
          <div class="rv-card-footer">
            <a href="j1-rdga-thonon-les-bains-beaufort.gpx" class="rv-card-link" target="_blank">Télécharger GPX</a>
          </div>
        </div>
      </article>

      <!-- Carte 03 -->
      <article class="rv-card"
               id="trip-03"
               data-gpx="j2-rdga-beaufort-briancon.gpx"
               data-images="j2rdga1.JPEG,j2rdga2.JPEG,j2rdga3.JPEG,j2rdga4.JPEG,j2rdga5.JPEG,j2rdga6.JPEG,j2rdga7.JPEG,j2rdga8.JPEG,j2rdga9.JPEG,j2rdga10.JPEG,j2rdga11.JPEG,j2rdga12.JPEG,j2rdga13.JPEG">
        <div class="rv-card-header">
          <span class="rv-card-id">03</span>
          <div class="rv-card-badges">
            <img src="montage.png" class="badge-icon" alt="Montagne">
          </div>
        </div>
        <div class="rv-card-media">
          <img src="j2rdga8.JPEG" alt="RDGA Jour 2 – De Beaufort à Briançon">
        </div>
        <div class="rv-card-body">
          <div class="rv-card-title-row">
            <h3 class="rv-card-title">RDGA Jour 2 – De Beaufort à Briançon</h3>
            <span class="rv-card-rating">★★★★</span>
          </div>
          <p class="rv-card-text">
          De Deuxième journée sur la route des Grandes Alpes. On monte en altitude, pensez à vous couvrir ! Un arret au lac de Roseland, puis direction le col du Saint Bernard et le col de l'Iseran. 
          Ensuite ca grimpe direction le Galibier puis le Lautaret. On en prend pleins les yeux... Redescente vers Briançon ensuite. Pour dormir, je vous conseille la Vallée de la Clarée. Et le soir une petite tartiflette dans la vieille ville de Briançon !
          </p>
          <div class="rv-card-meta">
            <div class="rv-card-stats">
              <div class="stat"><small>Distance</small><strong>493 km</strong></div>
              <div class="stat"><small>Altitude max ↑</small><strong>2 753 m</strong></div>
              <div class="stat"><small>Durée</small><strong>1 jour</strong></div>
              <div class="stat"><small>Niveau</small><strong>Confirmé</strong></div>
            </div>
          </div>
          <div class="rv-card-footer">
            <a href="j2-rdga-beaufort-briancon.gpx" class="rv-card-link" target="_blank">Télécharger GPX</a>
          </div>
        </div>
      </article>

      <!-- Cartes 04 -->
      <article class="rv-card"
               id="trip-04"
               data-gpx="j3-rdga-briancon-jausiers.gpx"
               data-images="j3rdga1.JPEG,j3rdga2.JPEG,j3rdga3.JPEG,j3rdga4.JPEG,j3rdga5.JPEG,j3rdga6.JPEG,j3rdga7.JPEG,j3rdga8.JPEG,j3rdga9.JPEG,j3rdga10.JPG">
        <div class="rv-card-header">
          <span class="rv-card-id">04</span>
          <div class="rv-card-badges">
            <img src="mer.png" class="badge-icon" alt="Mer">
            <img src="montage.png" class="badge-icon" alt="Montagne">
          </div>
        </div>
        <div class="rv-card-media">
          <img src="j3rdga5.JPEG" alt="RDGA Jour 3 – De Briançon à Jausier">
        </div>
        <div class="rv-card-body">
          <div class="rv-card-title-row">
            <h3 class="rv-card-title">RDGA Jour 3 – De Briançon à Jausier</h3>
            <span class="rv-card-rating">★★★★</span>
          </div>
          <p class="rv-card-text">
            Troisième journée sur la Route des Grandes Alpes. Un col mythique et des pyasages lunaires: le col de l'Izoard. On a ensuite la très belle route de Ceilac qui mérite un allé retour.
            Enfin le col de Vars. Poussez jusqu'à Barcelonette. L'été la place du centre ville est plutôt animé,et en septembre à lieu le mythique Trail adventure motofestival.
          </p>
          <div class="rv-card-meta">
            <div class="rv-card-stats">
              <div class="stat"><small>Distance</small><strong>230 km</strong></div>
              <div class="stat"><small>Altitude max ↑</small><strong>2 364 m</strong></div>
              <div class="stat"><small>Durée</small><strong>1 jour</strong></div>
              <div class="stat"><small>Niveau</small><strong>Intermédiaire</strong></div>
            </div>
          </div>
          <div class="rv-card-footer">
            <a href="j3-rdga-briancon-jausiers.gpx" class="rv-card-link" target="_blank">Télécharger GPX</a>
          </div>
        </div>
      </article>
            <!-- Cartes 05 -->
      <article class="rv-card"
               id="trip-05"
               data-gpx="auvergnepddcantal.gpx"
               data-images="auv1.JPEG,auv2.JPEG,auv3.JPEG,auv4.JPEG,auv5.JPEG,auv6.jpg,auv7.JPEG,auv8.jpg,auv9.jpg,auv10.jpg,video:auvergne.mp4">
        <div class="rv-card-header">
          <span class="rv-card-id">05</span>
          <div class="rv-card-badges">
            <img src="montage.png" class="badge-icon" alt="Montagne">
          </div>
        </div>
        <div class="rv-card-media">
          <img src="auv2.JPEG" alt="Volcans d'Auvergne - Puy de dôme et Cantal">
        </div>
        <div class="rv-card-body">
          <div class="rv-card-title-row">
            <h3 class="rv-card-title">Volcans d'Auvergne - Puy de dôme et Cantal</h3>
            <span class="rv-card-rating">★★★★</span>
          </div>
          <p class="rv-card-text">
            À l'occasion du ACES Experience, on a fait la boucle historique. Près de 300km entre Puy de dôme et le Cantal. Entre lac, volcans, et plaines immenses. Arretez vous pour déguster une bonne truffade à Murat ! Veillez à bien visser vos disques quand vous reprendrez la route (comprendra qui pourra !). Un arrêt de rigueur au Puy Mary pour ensuite redescendre sur Salers.
            Ensuite on s'est un peu perdu sur le retour ! On vous epargne ça, vous trouverez ici la boucle complète.
          </p>
          <div class="rv-card-meta">
            <div class="rv-card-stats">
              <div class="stat"><small>Distance</small><strong>298 km</strong></div>
              <div class="stat"><small>Altitude max ↑</small><strong>1 569 m</strong></div>
              <div class="stat"><small>Durée</small><strong>1 jour</strong></div>
              <div class="stat"><small>Niveau</small><strong>Confirmé</strong></div>
            </div>
          </div>
          <div class="rv-card-footer">
            <a href="auvergnepddcantal.gpx" class="rv-card-link" target="_blank">Télécharger GPX</a>
          </div>
        </div>
      </article>
      <article class="rv-card"
               id="trip-06"
               data-gpx="j2-rdga-beaufort-briancon.gpx"
               data-images="j2rdga1.JPEG,j2rdga2.JPEG,j2rdga3.JPEG,j2rdga4.JPEG,j2rdga5.JPEG,j2rdga6.JPEG,j2rdga7.JPEG,j2rdga8.JPEG,j2rdga9.JPEG,j2rdga10.JPEG,j2rdga11.JPEG,j2rdga12.JPEG,j2rdga13.JPEG">
        <div class="rv-card-header">
          <span class="rv-card-id">06</span>
          <div class="rv-card-badges">
            <img src="montage.png" class="badge-icon" alt="Montagne">
            <img src="forest.png" class="badge-icon" alt="Forêt">
          </div>
        </div>
        <div class="rv-card-media">
          <img src="j2rdga8.JPEG" alt="RDGA Jour 2 – De Beaufort à Briançon">
        </div>
        <div class="rv-card-body">
          <div class="rv-card-title-row">
            <h3 class="rv-card-title">RDGA Jour 2 – De Beaufort à Briançon</h3>
            <span class="rv-card-rating">★★★★★</span>
          </div>
          <p class="rv-card-text">
            Deuxième journée sur la Route des Grandes Alpes. On monte en altitude : lac de Roseland, col du Saint-Bernard, Iseran, Galibier, Lautaret… puis Briançon. Nuit dans la vallée de la Clarée et tartiflette en vieille-ville !
          </p>
          <div class="rv-card-meta">
            <div class="rv-card-stats">
              <div class="stat"><small>Distance</small><strong>493 km</strong></div>
              <div class="stat"><small>Altitude max ↑</small><strong>2 753 m</strong></div>
              <div class="stat"><small>Durée</small><strong>1 jour</strong></div>
              <div class="stat"><small>Niveau</small><strong>Confirmé</strong></div>
            </div>
          </div>
          <div class="rv-card-footer">
            <a href="j2-rdga-beaufort-briancon.gpx" class="rv-card-link" target="_blank">Télécharger GPX</a>
          </div>
        </div>
      </article>
    </div>

<!-- MODAL TRIP -->
<div id="trip-modal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <div id="map-modal"></div>
    <div id="trip-modal-card"></div>

    <!-- Galerie -->
    <div class="trip-gallery-modal">
      <h4>Galerie</h4>
      <div class="gallery-thumbs"></div>
    </div>
        </div>
      </div>
    

    <!-- LIGHTBOX MODAL IMAGE -->
    <div id="image-modal" class="modal">
      <div class="modal-content image-lightbox">
        <button class="lightbox-prev" aria-label="Image précédente">‹</button>
        <img id="image-modal-img" class="image-modal-img" src="" alt="Aperçu">
        <button class="lightbox-next" aria-label="Image suivante">›</button>
        <span class="modal-close">&times;</span>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div class="left-footer">
        <a href="home.html" style="display:flex; align-items:center; gap:.5rem;">
          <img src="./moulin-coeur-noir.png" alt="Logo"><span>Old Mill Riders</span>
        </a>
      </div>
      <div class="right-footer">
        <a href="labande.html">La Bande</a>
        <a href="LeShop.html">Le Shop</a>
        <a href="#" id="privacy-policy-link">Politique de confidentialité</a>
        <a href="#" id="legal-mentions-link">Mentions légales</a>
      </div>
    </div>

    <!-- AUTRES MODALS -->
    <div id="privacy-modal" class="modal">
      <div class="modal-content"><span class="modal-close">&times;</span></div>
    </div>
    <div id="legal-modal" class="modal">
      <div class="modal-content"><span class="modal-close">&times;</span></div>
    </div>

  </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // 0) Variables globales
  let currentTripId = null;                   // pour suivre le trip ouvert
  const COMMENTS_KEY   = 'omr_comments';
  const ADMIN_PASSWORD = 'TonMdpDeModération'; // personnalise ici

  // 1) Menu burger
  document.querySelector('.menu-toggle').addEventListener('click', () => {
    document.querySelector('header nav').classList.toggle('open');
  });

  // 2) Variables pour la carte GPX
  let mapInit = false, map, gpxLayer;

  // 3) Fonctions de gestion des commentaires
  function loadComments(tripId) {
    const all = JSON.parse(localStorage.getItem(COMMENTS_KEY) || '{}');
    return all[tripId] || [];
  }
  function saveComments(tripId, comments) {
    const all = JSON.parse(localStorage.getItem(COMMENTS_KEY) || '{}');
    all[tripId] = comments;
    localStorage.setItem(COMMENTS_KEY, JSON.stringify(all));
  }
  function renderComments(tripId) {
    const list     = document.querySelector('#trip-modal .comments-list');
    const comments = loadComments(tripId);
    const me       = localStorage.getItem('omr_pseudo');
    const isAdmin  = localStorage.getItem('omr_admin') === 'true';

    list.innerHTML = '';
    comments.forEach((c, idx) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'comment';

      // En-tête : pseudo + date
      const header = document.createElement('div');
      header.className = 'comment-header';

      const pseudoSpan = document.createElement('span');
      pseudoSpan.textContent = c.pseudo;

      const timeSpan = document.createElement('span');
      timeSpan.textContent = new Date(c.time)
        .toLocaleString('fr-FR', {
          day:    '2-digit',
          month:  '2-digit',
          year:   'numeric',
          hour:   '2-digit',
          minute: '2-digit'
        });

      header.append(pseudoSpan, timeSpan);

      // Bouton Supprimer si admin OU auteur
      if (isAdmin || c.pseudo === me) {
        const delBtn = document.createElement('button');
        delBtn.className = 'comment-delete';
        delBtn.textContent = 'Supprimer';
        delBtn.onclick = () => {
          if (!confirm('Supprimer ce commentaire ?')) return;
          comments.splice(idx, 1);
          saveComments(tripId, comments);
          renderComments(tripId);
        };
        header.append(delBtn);
      }

      // Texte
      const textDiv = document.createElement('div');
      textDiv.textContent = c.text;

      wrapper.append(header, textDiv);
      list.appendChild(wrapper);
    });
  }

  // 4) Lightbox
  function setupLightbox() {
    const thumbs     = Array.from(document.querySelectorAll('#trip-modal .gallery-thumbs > *'));
    const imageModal = document.getElementById('image-modal');
    const content    = imageModal.querySelector('.modal-content');
    const prevBtn    = content.querySelector('.lightbox-prev');
    const nextBtn    = content.querySelector('.lightbox-next');
    let idx = 0;

    content.addEventListener('click', e => e.stopPropagation());
    imageModal.addEventListener('click', () => closeModal(imageModal));

    thumbs.forEach((thumb, i) => {
      thumb.addEventListener('click', () => {
        idx = i;
        const existing = content.querySelector('img, video');
        if (existing) existing.remove();
        if (thumb.tagName === 'IMG') {
          const img = document.createElement('img');
          img.src = thumb.src;
          img.className = 'image-modal-img';
          content.insertBefore(img, prevBtn);
        } else {
          const vid = document.createElement('video');
          vid.src       = thumb.src;
          vid.controls  = true;
          vid.autoplay  = true;
          vid.className = 'image-modal-img';
          content.insertBefore(vid, prevBtn);
        }
        imageModal.style.display = 'flex';
      });
    });

    prevBtn.addEventListener('click', e => {
      e.stopPropagation();
      idx = (idx - 1 + thumbs.length) % thumbs.length;
      thumbs[idx].click();
    });
    nextBtn.addEventListener('click', e => {
      e.stopPropagation();
      idx = (idx + 1) % thumbs.length;
      thumbs[idx].click();
    });

    // Swipe mobile
    let startX = 0;
    imageModal.addEventListener('touchstart', e => {
      startX = e.changedTouches[0].screenX;
    });
    imageModal.addEventListener('touchend', e => {
      const endX = e.changedTouches[0].screenX;
      if (Math.abs(endX - startX) > 50) {
        if (endX < startX) nextBtn.click();
        else prevBtn.click();
      }
    });
  }

  // 5) Fermeture modal
  function closeModal(modal) {
    const vid = modal.querySelector('video');
    if (vid) vid.pause();
    modal.style.display = 'none';
    document.body.classList.remove('modal-open');
  }

  // 6) Mode modération (toggle + re-render si modal ouvert)
  document.getElementById('admin-login').addEventListener('click', () => {
    const btn     = document.getElementById('admin-login');
    const isAdmin = localStorage.getItem('omr_admin') === 'true';

    if (isAdmin) {
      localStorage.removeItem('omr_admin');
      btn.classList.remove('active');
    } else {
      const pwd = prompt('Mot de passe modération :');
      if (pwd === ADMIN_PASSWORD) {
        localStorage.setItem('omr_admin', 'true');
        btn.classList.add('active');
      } else {
        alert('Mot de passe incorrect');
        return;
      }
    }

    if (currentTripId &&
        document.getElementById('trip-modal').style.display === 'flex') {
      renderComments(currentTripId);
    }
  });

  // 7) Ouverture du trip-modal
  document.querySelectorAll('.rv-card').forEach(card => {
    card.addEventListener('click', () => {
      currentTripId = card.id;

      // Ouvre modal + cache footer
      const modal = document.getElementById('trip-modal');
      modal.style.display = 'flex';
      document.body.classList.add('modal-open');

      // Clone carte sans media
      const container = document.getElementById('trip-modal-card');
      container.innerHTML = '';
      const clone = card.cloneNode(true);
      clone.removeAttribute('id');
      clone.style.width = '100%';
      const media = clone.querySelector('.rv-card-media');
      if (media) media.remove();
      container.appendChild(clone);

      // Init map une fois
      if (!mapInit) {
        map = L.map('map-modal').setView([45.3639, 5.83], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors'
        }).addTo(map);
        mapInit = true;
      }
      // Charge GPX
      const gpxFile = card.dataset.gpx;
      if (gpxLayer) map.removeLayer(gpxLayer);
      gpxLayer = new L.GPX(gpxFile, {
        async: true,
        marker_options: { startIconUrl: null, endIconUrl: null },
        polyline_options: { color: '#0077cc', weight: 4, opacity: 0.8 }
      }).on('loaded', e => map.fitBounds(e.target.getBounds()))
        .addTo(map);

      // Construit galerie
      const thumbs = document.querySelector('#trip-modal .gallery-thumbs');
      thumbs.innerHTML = '';
      card.dataset.images.split(',').forEach((src, i) => {
        const item = src.trim();
        if (item.startsWith('video:')) {
          const videoSrc = item.replace(/^video:/, '');
          const vid = document.createElement('video');
          vid.poster      = videoSrc.replace(/\.mp4$/, 'auvergne.jpg');
          vid.src         = videoSrc;
          vid.muted       = true;
          vid.playsInline = true;
          vid.preload     = 'metadata';
          vid.controls    = false;
          vid.className   = 'thumb-video';
          thumbs.appendChild(vid);
        } else {
          const img = document.createElement('img');
          img.src = item;
          img.alt = `Photo ${i + 1}`;
          thumbs.appendChild(img);
        }
      });

      setupLightbox();

      // Pré-remplit pseudo + affiche commentaires
      document.getElementById('comment-pseudo').value =
        localStorage.getItem('omr_pseudo') || '';
      renderComments(currentTripId);

      // Formulaire nouveau commentaire
      const form   = document.getElementById('comment-form');
      const input  = document.getElementById('comment-input');
      const pseudo = document.getElementById('comment-pseudo');
      form.onsubmit = e => {
        e.preventDefault();
        const name = pseudo.value.trim();
        const text = input.value.trim();
        if (!name || !text) return;
        localStorage.setItem('omr_pseudo', name);
        const comments = loadComments(currentTripId);
        comments.push({ pseudo: name, text, time: Date.now() });
        saveComments(currentTripId, comments);
        renderComments(currentTripId);
        input.value = '';
      };
    });
  });

  // 8) Fermeture de tous les modals
  document.querySelectorAll('.modal-close').forEach(btn => {
    btn.addEventListener('click', () => closeModal(btn.closest('.modal')));
  });
  window.addEventListener('click', e => {
    if (e.target.classList.contains('modal')) {
      closeModal(e.target);
    }
  });
});
</script>

</body>
</html>
